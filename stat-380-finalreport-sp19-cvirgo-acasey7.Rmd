---
title: "Final Project Report"
author: "Andrew Casey & Ciara Virgo"
date: "Due April 30, 2019"
output: html_notebook
---

```{r echo=TRUE, message=FALSE}
# always clean up R environment
rm(list = ls())

# loading packages
library(mdsr)
library(tidyr)
library(data.table)
library(stringr)
library(dplyr)
library(ggplot2)
library(plyr)
library(klaR)

# loading in data
Heart_Raw <- fread("NCHS_-_Potentially_Excess_Deaths_from_the_Five_Leading_Causes_of_Death.csv")
Tobacco_Raw <- fread("Behavioral_Risk_Factor_Data__Tobacco_Use__2010_And_Prior_.csv")
```


##Data Wrangling

```{r}
#Filter the Smoking Data to narrow it down to 3 States and years common between the two data sets
#Also remove all, but the necessary columns
HeartData <-
  Heart_Raw %>%
  dplyr::select(Year, `Cause of Death`, State, `Age Range`, Locality, `Observed Deaths`, Benchmark) %>%
  filter(`Cause of Death` == "Heart Disease") %>%
  filter(State %in% c("Pennsylvania", "Texas", "Washington")) %>%
  filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010)) %>%
  filter(Locality %in% c("Metropolitan", "Nonmetropolitan")) %>%
  filter(Benchmark %in% c("2005 Fixed"))

#Filter the Heart Disease Data to narrow it down to 3 states and years common between the two data sets
#Also remove all, but the necessary columns
TobaccoData <-
  Tobacco_Raw %>%
  dplyr::select(YEAR, LocationDesc, TopicType, TopicDesc, MeasureDesc, Sample_Size, Gender, Race, Age, Education) %>%
  setnames(old=c("YEAR","LocationDesc", "Age"), new=c("Year", "State", "Age Range")) %>%
  filter(State %in% c("Pennsylvania", "Texas", "Washington")) %>%
  filter(Year %in% c(2005, 2006, 2007, 2008, 2009, 2010))

#Remove the rows that contain Male and Female, so there are only rows with Overall.
Rows1 <- TobaccoData$Gender=="Overall"
TobaccoData <- TobaccoData[Rows1,]

#Remove the rows that contain All Ages for the age range
Rows2 <- TobaccoData$`Age Range`=="All Ages"
TobaccoData <- TobaccoData[Rows2==FALSE,]

#Remove the rows that have anything but All Grades as the education level
Rows3 <- TobaccoData$Education=="All Grades"
TobaccoData <- TobaccoData[Rows3,]

TobaccoData <-
  TobaccoData %>%
  dplyr::select(-c(7,8,10))

#Changes the Sample Size column to numeric variables
TobaccoData$Sample_Size <- as.numeric(gsub(",", "", TobaccoData$Sample_Size))
TobaccoData$Sample_Size <- as.numeric(as.character(TobaccoData$Sample_Size))
```

```{r}
#Changes the labels of the Age Ranges in both data sets so they are common
for(i in 1:length(HeartData$`Age Range`)){
  if(HeartData$`Age Range`[i] == "0-49"){
    HeartData$`Age Range`[i] <- c("44 Years and Below")
  }
  else if(HeartData$`Age Range`[i] == "0-54"){
    HeartData$`Age Range`[i] <- c("45 to 64 Years")
  }
  else if(HeartData$`Age Range`[i] == "0-59"){
    HeartData$`Age Range`[i] <- c("45 to 64 Years")
  }
  else if(HeartData$`Age Range`[i] == "0-64"){
    HeartData$`Age Range`[i] <- c("45 to 64 Years")
  }
  else if(HeartData$`Age Range`[i] == "0-69"){
    HeartData$`Age Range`[i] <- c("65 Years and Older")
  }
  else if(HeartData$`Age Range`[i] == "0-74"){
    HeartData$`Age Range`[i] <- c("65 Years and Older")
  }
  else if(HeartData$`Age Range`[i] == "0-79"){
    HeartData$`Age Range`[i] <- c("65 Years and Older")
  }
  else if(HeartData$`Age Range`[i] == "0-84"){
    HeartData$`Age Range`[i] <- c("65 Years and Older")
  }
}
for(i in 1:length(TobaccoData$`Age Range`)){
  if(TobaccoData$`Age Range`[i] == "18 to 24 Years"){
    TobaccoData$`Age Range`[i] <- c("44 Years and Below")
  }
  else if(TobaccoData$`Age Range`[i] == "25 to 44 Years"){
    TobaccoData$`Age Range`[i] <- c("44 Years and Below")
  }
}
```

```{r}
#Function that makes the data longer by duplicating the number of rows by the value in the sample size column and making the data set have more rows.
TobaccoCasestoRows <- function(){
  Year <- vector()
  State <- vector()
  TopicType <- vector()
  TopicDesc <- vector()
  MeasureDesc <- vector()
  AgeRange <- vector()
  for (i in 1:length(TobaccoData$Sample_Size)){
    Year <- c(Year, rep(TobaccoData$Year[i], TobaccoData$Sample_Size[i]))
    State <- c(State, rep(TobaccoData$State[i], TobaccoData$Sample_Size[i]))
    TopicType <- c(TopicType, rep(TobaccoData$TopicType[i], TobaccoData$Sample_Size[i]))
    TopicDesc <- c(TopicDesc, rep(TobaccoData$TopicDesc[i], TobaccoData$Sample_Size[i]))
    MeasureDesc <- c(MeasureDesc, rep(TobaccoData$MeasureDesc[i], TobaccoData$Sample_Size[i]))
    AgeRange <- c(AgeRange, rep(TobaccoData$`Age Range`[i], TobaccoData$Sample_Size[i]))
  }
  df <- data.frame(Year, State, TopicType, TopicDesc, MeasureDesc, AgeRange)
  return(df)
}
Tobacco <- TobaccoCasestoRows()
```

```{r}
HeartCasestoRows <- function(){
  Year <- vector()
  State <- vector()
  AgeRange <- vector()
  Locality <- vector()
  for (i in 1:length(HeartData$`Observed Deaths`)){
    Year <- c(Year, rep(HeartData$Year[i], HeartData$`Observed Deaths`[i]))
    State <- c(State, rep(HeartData$State[i], HeartData$`Observed Deaths`[i]))
    Locality <- c(Locality, rep(HeartData$Locality[i], HeartData$`Observed Deaths`[i]))
    AgeRange <- c(AgeRange, rep(HeartData$`Age Range`[i], HeartData$`Observed Deaths`[i]))
  }
  df <- data.frame(Year, State, Locality, AgeRange)
  return(df)
}
Heart <- HeartCasestoRows()
```

```{r}
Heart_age <- 
  HeartData %>%
  select(`Age Range`)

head(grep("[18]", Heart_age, value = TRUE))
```


##Data Visualization

```{r}
# x = year, y = # of people with heart disease by tobacco use

Heart2 <-
  Heart %>%
  dplyr::select(Year, State, AgeRange) 

Heart2["MeasureDesc"] <- "Heart Disease"

Tobacco2 <- 
  Tobacco %>%
 dplyr::select(Year, State, AgeRange, MeasureDesc)


Measure <-
  rbind(Heart2, Tobacco2)

  
  

Tobacco$Year <- as.factor(Tobacco$Year)
Heart$Year <- as.factor(Heart$Year)

Tobacco <- as.data.frame(matrix(nrow = 276252, ncol = 6, dimnames = list(NULL, c("Year", "State"))))
Heart <- as.data.frame(matrix(nrow = 1076451, ncol = 4, dimnames = list(NULL, c("Year", "State"))))

Tobacco(as.factor(sample(2005:2010, size = nrow(Tobacco), replace = TRUE)))
```

```{r}
# x = year, y = # of people with heart disease  ** between all four states
ggplot()
```

```{r}
# DeathData: x = Age Range, y = # of heart disease

ggplot(Tobacco, aes(x = Year)) +
  geom_histogram(stat = "count") +
  geom_bar(aes(fill = AgeRange))
```

```{r}
#HeartData: x = year, y = multiple bar chart by state

ggplot(Tobacco, aes(x = State)) +
  geom_histogram(stat = "count") +
  geom_bar(aes(fill = AgeRange))
```


##Data Analysis

```{r}

```





